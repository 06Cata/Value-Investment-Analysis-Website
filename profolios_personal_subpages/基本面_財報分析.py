import streamlit as st 
from urllib.parse import quote
from requests.exceptions import HTTPError
import random

from pages.profolios_personal_subpages.tw_stock_crawler_030 import get_tables_of_dbtablename, get_stock_code_industry, \
plotly_ocf_icf_fcf, plotly_ocf_ni, plotly_net_free_cash_flow, plotly_business, plotly_shareholders_equity, \
plotly_cfr_3, plotly_cashncash_equivalents,\
plotly_days_sales_outstanding, plotly_fake, plotly_fixed_asset_turnover_ratio,\
plotly_roe, plotly_roa, plotly_eps, read__monthly_report_from_sqlite, plotly_3_rate, plotly_operating_margin_of_safety, plotly_year_revenue,\
plotly_4q_revenue_growth_rate, plotly_non_operating_earnings, plotly_tax,\
plotly_debt_to_asset_ratio,  plotly_ratio_of_liabilities_to_assets, plotly_total_debt_equity_ratio,\
plotly_debt_paying_ability


def main():
    st.subheader("åŸºæœ¬é¢: è²¡å ±åˆ†æ")
    st.write('''å·´è²ç‰¹æ›¾èªª "You make your money when you buy, not when you sell."ï¼Œè²·ä¼æ¥­ï¼Œä¸æ˜¯è²·è‚¡ç¥¨ï¼ŒæŠ•è³‡è€…æ‡‰è©²å°ˆæ³¨æ–¼è©•ä¼°ä¼æ¥­çš„åŸºæœ¬åƒ¹å€¼ï¼Œä¸¦é•·æœŸæŒæœ‰ï¼Œå‹ç‡æ›´å¤§  
             ''')  

    st.write('''è³‡æ–™ä¾†æº: "å…¬é–‹è³‡è¨Šè§€æ¸¬ç«™"ï¼Œè®€å–è³‡æ–™åº« [(1)](https://github.com/06Cata/tw_financial_reports1)ã€[(2)](https://github.com/06Cata/tw_financial_reports2)ã€\
            [(3)](https://github.com/06Cata/tw_financial_reports3)ã€‚ä»¥ä¸Šè§€é»åƒ…ä¾›åƒè€ƒï¼Œä¸¦ä¸æ§‹æˆä»»ä½•äº¤æ˜“å»ºè­°æˆ–æ¨è–¦ã€‚æ•¸å€¼å¤ªæ¥è¿‘ï¼ŒæŠ˜ç·šåœ–æœ‰å¯èƒ½é‡ç–Šï¼Œå¯ä»¥åˆ†åˆ¥é»æ“ŠæŸ¥çœ‹''')

    stock_code = st.text_input("è«‹è¼¸å…¥è‚¡ç¥¨ä»£ç¢¼ï¼š", value='2885')

    if st.button("æŸ¥è©¢"):
        loading_messages = [
            "é€™ä¸æ˜¯ç…®æ³¡éºµï¼Œéœ€è¦ä¸€é»æ™‚é–“çš„",
            "æ”¾è¼•é¬†ï¼Œä¸æ˜¯ç­‰é–‹æœƒï¼Œæ˜¯ç­‰å¾…ä½ çš„è³‡ç”¢ç¿»å€~",
            "æŠ“äº”å¹´è³‡æ–™ï¼Œä¸æ˜¯ç¬é–“é­”æ³•ï¼Œæ˜¯è€åŠ›çš„é­”æ³•ï¼",
            "ç­‰ä¸€ä¸‹ï¼Œé€™æ¯”ä½ å°åˆ®åˆ®æ¨‚å¿«",
            "æ²’è€å¿ƒå°±åƒæ‰“é–‹å†°ç®±æ‰¾æ±è¥¿ï¼Œæ‰¾ä¸åˆ°çš„æ™‚å€™åªæœƒæ›´ç”Ÿæ°£",
            "ç­‰å¾…ä¸­...é€™ä¸æ˜¯ç­‰ç´…ç‡ˆï¼Œæ˜¯ç­‰å¾…è²¡å¯Œçš„ç¶ ç‡ˆ",
            "å°±åƒç­‰å¾…æ‰‹æ–é£²æ–™ä¸€æ¨£ï¼ŒåŠ é»æ–™å°±èƒ½æ›´å¥½å–ï¼Œæˆ‘æ¯”è¼ƒå–œæ­¡å¥¶è“‹",
            "æ”¾è¼•é¬†ï¼Œé€™ä¸æ˜¯ç­‰è€ƒç¸¾ï¼Œæ˜¯ç­‰å¾…ä½ çš„æŠ•è³‡ç±Œç¢¼è®Šæˆé»ƒé‡‘"
        ]

        loading_message = random.choice(loading_messages)
        st.text(loading_message)
         
        
        # stock_code, stock_name, stock_industry, related_data = get_stock_code_industry(stock_code)
        try:
            stock_code, stock_name, stock_size, stock_industry, related_data = get_stock_code_industry(stock_code)
            dfs, suss_tables = get_tables_of_dbtablename(int(stock_code))
        except Exception as e:
            st.write('å¾ˆæŠ±æ­‰æ•¸æ“šåº«æ²’æœ‰é€™éš»è‚¡ç¥¨ã€é€£ä¸ä¸Šæ•¸æ“šåº«ï¼Œæˆ–å‡ºç¾å…¶ä»–éŒ¯èª¤')
            # st.write(f'éŒ¯èª¤è¨Šæ¯: {str(e)}')
            return

                
        related_datas = []
        for r in related_data:
            related_datas.append(r)
            
        # å‰µå»ºå¯æ“´å±•å€åŸŸ
        with st.expander(f"é¸æ“‡çš„æ˜¯ {stock_code} {stock_name} ï¼Œ{stock_industry}  ({stock_size})ï¼ŒåŒç”¢æ¥­çš„æœ‰"):
            st.write(related_datas )


        # dfs, suss_tables = get_tables_of_dbtablename(int(stock_code))
        # å‰µå»ºå¯æ“´å±•å€åŸŸ_2
        with st.expander(f"ç”¨é›»è…¦æ›´å¥½çœ‹ï¼Œå·²æˆåŠŸæŠ“å–åˆ°çš„è³‡æ–™"):
            if not dfs and not suss_tables:
                st.write('å¾ˆæŠ±æ­‰ï¼Œæ²’æœ‰é€™æª”è‚¡ç¥¨çš„è³‡æ–™')
            else:
                st.write(suss_tables)
        

        # ä¿å­˜æŸ¥è©¢çš„ç‹€æ…‹
        st.session_state.stock_data = {
            'stock_code': stock_code,
            'dfs': dfs,
            'suss_tables': suss_tables
        }
        
        
        ##########################
        # å‰µå»ºé é¢ä¸Šæ–¹çš„é¸é …
        # if st.button("è·³åˆ°ç¾é‡‘æµé‡"):
        #     st.markdown('[è·³åˆ°ç¾é‡‘æµé‡](#ç¾é‡‘æµé‡)', unsafe_allow_html=True)

        # # å‰µå»ºé é¢ä¸Šæ–¹çš„é¸é …
        # # åœ¨æŒ‰ä¸‹ã€Œè·³åˆ°ç¾é‡‘æµé‡ã€æŒ‰éˆ•æ™‚ï¼Œè¨­å®š session_state.scroll_to_cash_flow
        # if st.button("è·³åˆ°ç¾é‡‘æµé‡"):
        #     st.session_state.scroll_to_cash_flow = True

        # # åœ¨æ¸²æŸ“æ™‚ï¼Œæª¢æŸ¥æ˜¯å¦éœ€è¦æ»¾å‹•åˆ°ç¾é‡‘æµé‡éƒ¨åˆ†
        # if getattr(st.session_state, 'scroll_to_cash_flow', False):
        #     st.markdown("""<script>window.location.href='#ç¾é‡‘æµé‡'</script>""", unsafe_allow_html=True)
        #     st.session_state.scroll_to_cash_flow = False

        # if st.button("è·³åˆ°ç¾é‡‘æµé‡"):
        #     st.markdown('<div id="scroll_target"></div>', unsafe_allow_html=True)
        #     st.markdown("""<script>window.location.href='#scroll_target';</script>""", unsafe_allow_html=True)


        
        ####################################
        st.subheader("")
        # st.markdown('<div id="scroll_target"></div><a name="ç¾é‡‘æµé‡"></a>', unsafe_allow_html=True)
        st.subheader("ã€ç¾é‡‘æµé‡ã€‘")
        
        
        try:
            # ç¾é‡‘æµé‡è¡¨ (æ¯”æ°£é•·ï¼Œæœ‰ä¸‰é•·) 
            # 001 åŒ…æˆdef
            # ocf icf fcf
            # éŠ€è¡Œæ¥­okä¸ç”¨èª¿
            st.markdown("#### â˜… ç¾é‡‘æµé‡ï¼Œç¾é‡‘è¶Šå¤šæ°£è¶Šé•·ï¼Œæ›´èƒ½æ‡‰å°å¯èƒ½çš„ä¸ç¢ºå®šæ€§")
            fig, fig2, fig3 = plotly_ocf_icf_fcf(dfs)
            st.write('''
                ç¾é‡‘æµé‡é«”ç¾ä¼æ¥­å¯¦éš›çš„è³‡é‡‘ï¼Œå¾ä¸­è§€å¯Ÿç‡Ÿé‹æ–¹å‘  
                ç‡Ÿæ¥­æ´»å‹•ç¾é‡‘æµ: æ­£çš„ï¼Œè³ºéŒ¢ï¼›è² çš„ï¼Œè³ éŒ¢  
                æŠ•è³‡æ´»å‹•ç¾é‡‘æµ: æ­£çš„ï¼Œè®Šè³£è³‡ç”¢ï¼›è² çš„ï¼ŒæŠ•è³‡è‡ªå·±ï¼ŒæŒçºŒæ“´å¼µ  
                èè³‡æ´»å‹•ç¾é‡‘æµ: æ­£çš„ï¼Œå€ŸéŒ¢ï¼›è² çš„ï¼Œé‚„éŒ¢ã€æ¸›è³‡...
                ''')
            st.plotly_chart(fig) 
            st.plotly_chart(fig2)
            st.plotly_chart(fig3)
        
        except:
            pass
 
 

        try:
            # 001-2 åŒ…æˆdef
            # ocf ni æ¯”è¼ƒ 
            # éŠ€è¡Œæ¥­ä¸çœ‹
            if stock_industry == "ç”¢æ¥­åˆ¥ï¼šé‡‘èä¿éšªæ¥­ï¼ˆå…¶ä¸­é‡‘æ§å…¬å¸ä¿‚æ§è‚¡å…¬å¸ï¼Œå…¶ç”³å ±ä¹‹ã€Œç‡Ÿæ¥­æ”¶å…¥ã€ä¿‚èªåˆ—æ‰€æœ‰å­å…¬å¸æç›Šä¹‹åˆè¨ˆæ•¸ï¼‰" or stock_industry == "ç”¢æ¥­åˆ¥ï¼šé‡‘èæ¥­":
                pass
            else:
                st.markdown("#### â˜… ç‡Ÿæ¥­æ´»å‹•ç¾é‡‘æµé‡OCFæ¯”è¼ƒ")
                fig, fig2, fig3 = plotly_ocf_ni(dfs)
                st.write('''
                    OCFæ˜¯å¦>0ï¼Œç‡Ÿæ¥­æ´»å‹•ç¾é‡‘æµæŒçºŒç‚ºæ­£ï¼Œè¡¨ç¤ºä¼æ¥­åœ¨ç‡Ÿé‹ä¸­æŒçºŒç”¢ç”Ÿç¾é‡‘ï¼Œç©©å®šå¢é•·æœ€å¥½  
                    OCFæ˜¯å¦>æµå‹•è² å‚µï¼Œç‡Ÿæ¥­æ´»å‹•ç¾é‡‘æµè¶³ä»¥æ”¯ä»˜æµå‹•è² å‚µ(ä¸æ€•è¢«å‚¬æ”¶å¸³æ¬¾)   
                    OCFæ˜¯å¦>å›ºå®šè³‡ç”¢ï¼Œç‡Ÿæ¥­æ´»å‹•ç¾é‡‘æµè¶³å¤ æ”¯ä»˜å›ºå®šè³‡ç”¢çš„æŠ•è³‡ï¼Œè¡¨ç¤ºä¼æ¥­æœ‰èƒ½åŠ›è‡ªä¸»æ“´å¼µï¼Œä¸å¿…éåº¦ä¾è³´å¤–éƒ¨è³‡é‡‘(è³ºçš„éŒ¢å¯ä»¥è‡ªçµ¦è‡ªè¶³ï¼ŒæŠ•è³‡è‡ªå·±)
                    ''')
                st.plotly_chart(fig)
                st.write('''
                    ç‡Ÿæ¥­æ´»å‹•ç¾é‡‘æµèˆ‡æ·¨åˆ©èµ°å‹¢è¦ç›¸åŒï¼Œè¡¨ç¤ºä¼æ¥­çš„æ·¨åˆ©ä¾†è‡ªå¯¦éš›çš„ç¾é‡‘æ”¶å…¥  
                    ç‡Ÿæ¥­æ´»å‹•é«˜ã€æ·¨åˆ©ä½æ™‚ï¼Œå…¬å¸å¯èƒ½æœ‰é«˜ç‡Ÿé‹è²»ç”¨ã€æŠ•è³‡æ´»å‹•ã€æŠ˜èˆŠæ”¤éŠ·ã€æ‡‰æ”¶å¸³æ¬¾ã€å­˜è²¨å¢åŠ   
                    ç‡Ÿæ¥­æ´»å‹•ä½ã€æ·¨åˆ©é«˜æ™‚ï¼Œå…¬å¸å¯èƒ½æ¨é²æ‡‰ä»˜å¸³æ¬¾ã€æœ‰éç¾é‡‘æ€§è³ªçš„æ”¶å…¥  
                    å…¬å¼:  
                    ç²åˆ©å«é‡‘é‡ = ç‡Ÿæ¥­æ´»å‹•ç¾é‡‘æµ / æ·¨åˆ©ï¼Œå…¬å¸å¯¦éš›ç¾é‡‘æµå…¥ç›¸å°æ–¼æ·¨åˆ©æ½¤çš„æ¯”ä¾‹ï¼Œé«˜æ–¼100%è¡¨ç¤ºä¼æ¥­èƒ½å¤ å°‡æ·¨åˆ©è½‰åŒ–ç‚ºç¾é‡‘
                    ''')
                st.plotly_chart(fig2)
                st.plotly_chart(fig3)
        except:
            pass
        
        
        
        try:
            # 001-3 åŒ…æˆdef
            # æ·¨ç¾é‡‘æµé‡ã€è‡ªç”±ç¾é‡‘æµé‡
            # éŠ€è¡Œæ¥­okä¸ç”¨èª¿
            st.markdown("#### â˜… æ·¨ç¾é‡‘æµé‡ã€è‡ªç”±ç¾é‡‘æµé‡")
            fig, fig2, positive_count2  = plotly_net_free_cash_flow(dfs)
            st.write('''
                æ·¨ç¾é‡‘æµé‡: ä¸€é–“å…¬å¸éŒ¢æ˜¯æµå‡ºå»å¤šoræµé€²ä¾†å¤š  
                è‡ªç”±ç¾é‡‘æµé‡: å…¬å¸å¯ä»¥è‡ªç”±é‹ç”¨çš„ç¾é‡‘  
                è‡ªç”±ç¾é‡‘æµé‡é«˜ï¼Œè¡¨ç¤ºå…¬å¸åœ¨è³‡æœ¬æ”¯å‡º(æ“´å¼µæˆ–æŠ•è³‡ç­‰)å¾Œï¼Œä»æœ‰è¼ƒå¤šç¾é‡‘å¯ä¾›é‹ç”¨ï¼Œæä¾›äº†å½ˆæ€§   
                è‡ªç”±ç¾é‡‘æµé‡ä½ï¼Œè¡¨ç¤ºå…¬å¸å¯èƒ½æœ‰ç›¸ç•¶å¤šçš„è³‡æœ¬æ”¯å‡º(æ“´å¼µæˆ–æŠ•è³‡ç­‰ï¼Œæ­é…ç¾é‡‘ã€ä¸å‹•ç”¢ã€å» æˆ¿åŠè¨­å‚™æŸ¥çœ‹)  
                å…¬å¼:   
                    æ·¨ç¾é‡‘æµé‡ = ç‡Ÿæ¥­æ´»å‹•ç¾é‡‘æµ + æŠ•è³‡æ´»å‹•ç¾é‡‘æµ + ç±Œè³‡æ´»å‹•ç¾é‡‘æµ  
                    è‡ªç”±ç¾é‡‘æµé‡ = ç‡Ÿæ¥­æ´»å‹•ç¾é‡‘æµ + æŠ•è³‡æ´»å‹•ç¾é‡‘æµ
                ''') 
            if positive_count2 < 5:
                st.write(f'*è¿‘å…«å­£ä¸­è‡ªç”±ç¾é‡‘æµé‡ï¼Œæœ‰{positive_count2}å­£æ˜¯æ­£çš„ï¼Œç¨ä½ï¼Œè«‹èˆ‡åŒæ¥­æ¯”è¼ƒ')
            else:
                st.write(f'*è¿‘å…«å­£ä¸­è‡ªç”±ç¾é‡‘æµé‡ï¼Œæœ‰{positive_count2}å­£æ˜¯æ­£çš„ï¼Œä¸éŒ¯ï¼Œè«‹èˆ‡åŒæ¥­æ¯”è¼ƒå¯ä»¥èˆ‡åŒæ¥­æ¯”è¼ƒ')
            st.plotly_chart(fig)
            st.plotly_chart(fig2)
        except:
            pass



        try:
            # 002-2 åŒ…æˆdef
            # ç¾é‡‘èˆ‡ç´„ç•¶ç¾é‡‘(æµå‹•è³‡ç”¢)ã€ä¸å‹•ç”¢å» æˆ¿åŠè¨­å‚™(éæµå‹•è³‡ç”¢)ã€æµå‹•è² å‚µåˆè¨ˆã€éæµå‹•è² å‚µåˆè¨ˆã€é•·æœŸè³‡é‡‘(éæµå‹•è² å‚µ)è¶¨å‹¢
            # éŠ€è¡Œæ¥­ä¸çœ‹
            if stock_industry == "ç”¢æ¥­åˆ¥ï¼šé‡‘èä¿éšªæ¥­ï¼ˆå…¶ä¸­é‡‘æ§å…¬å¸ä¿‚æ§è‚¡å…¬å¸ï¼Œå…¶ç”³å ±ä¹‹ã€Œç‡Ÿæ¥­æ”¶å…¥ã€ä¿‚èªåˆ—æ‰€æœ‰å­å…¬å¸æç›Šä¹‹åˆè¨ˆæ•¸ï¼‰" or stock_industry == "ç”¢æ¥­åˆ¥ï¼šé‡‘èæ¥­":
                pass
            else:
                st.markdown("#### â˜… èˆ‡ä¸‹æ–¹ä¸€èµ·æŸ¥çœ‹")
                fig, fig2 = plotly_business(dfs)
                st.write('''
                    ç¾é‡‘ã€ä¸å‹•ç”¢ã€å» æˆ¿åŠè¨­å‚™ï¼Œèˆ‡å¾Œé¢"è³‡æœ¬å…¬ç©"ä¸€èµ·çœ‹  
                    è§€å¯Ÿæ˜¯å¦æœ‰è‚¡æœ¬æº¢åƒ¹(ç¾é‡‘å¢ã€è³‡æœ¬å…¬ç©å¢)ã€è³‡ç”¢é‡ä¼°(ç¾é‡‘å¢æ¸›ã€è³‡æœ¬å…¬ç©å¢æ¸›)ã€  
                    è™•åˆ†å›ºå®šè³‡ç”¢(ç¾é‡‘å¢ã€ä¸å‹•ç”¢æ¸›ã€è³‡æœ¬å…¬ç©å¢)  
                    è§€å¯Ÿç¾é‡‘ã€ä¸å‹•ç”¢ã€å» æˆ¿åŠè¨­å‚™ã€é•·æœŸå€Ÿæ¬¾ï¼Œæ˜¯å¦å¤§å¹…å¢åŠ ï¼Œå…¬å¸æ˜¯å¦å€ŸéŒ¢ä¾†æ“´å¼µæ¥­å‹™
                            ''')
                st.plotly_chart(fig) 
                st.plotly_chart(fig2)
        except:
            pass
        
        
        
        try:
            # 004 åŒ…æˆdef
            # è‚¡æ±æ¬Šç›Š: è‚¡æœ¬ã€ä¿ç•™ç›ˆé¤˜ã€è³‡æœ¬å…¬ç©
            # éŠ€è¡Œæ¥­ok 
            fig, fig2 = plotly_shareholders_equity(dfs)
            st.write('''
                è‚¡æœ¬: å…¬å¸ç™¼è¡Œçš„æ‰€æœ‰æ™®é€šè‚¡çš„ç¸½é¡  
                ä¿ç•™ç›ˆé¤˜: å¾æ·¨åˆ©ä¸­ä¿ç•™ä¸‹ä¾†çš„ï¼Œé¡¯ç¤ºå…¬å¸çš„ç²åˆ©èƒ½åŠ›  
                è³‡æœ¬å…¬ç©: ä¼æ¥­æ”¶åˆ°çš„è³‡é‡‘è¶…éè‚¡ç¥¨é¢é¡ï¼Œä»£è¡¨é¡å¤–çš„è³‡æœ¬å¢å€¼ï¼Œé¡¯ç¤ºå¸‚å ´ä¸Šçš„åƒ¹å€¼å’ŒæŠ•è³‡è€…çš„ä¿¡å¿ƒ  
                å¦‚æœæœ‰ä¼æ¥­ç”¨å…¬ç©é…è‚¡ï¼Œè¦æ³¨æ„æ˜¯å¦å› ç‚ºæ·¨åˆ©ä¸ç†æƒ³ï¼Œç‚ºäº†ç¶­æŒè‚¡åƒ¹è€Œé€²è¡Œå…¬ç©é…è‚¡
                        ''')
            st.plotly_chart(fig) 
            st.plotly_chart(fig2)
        except:
            pass
        
        
        
        try:
            # 002~004 åŒ…æˆdef
            # ç¾é‡‘æµé‡é—œéµ
            # éŠ€è¡Œæ¥­ä¸çœ‹
            if stock_industry == "ç”¢æ¥­åˆ¥ï¼šé‡‘èä¿éšªæ¥­ï¼ˆå…¶ä¸­é‡‘æ§å…¬å¸ä¿‚æ§è‚¡å…¬å¸ï¼Œå…¶ç”³å ±ä¹‹ã€Œç‡Ÿæ¥­æ”¶å…¥ã€ä¿‚èªåˆ—æ‰€æœ‰å­å…¬å¸æç›Šä¹‹åˆè¨ˆæ•¸ï¼‰" or stock_industry == "ç”¢æ¥­åˆ¥ï¼šé‡‘èæ¥­":
                pass
            else:
                st.markdown("#### â˜… ç¾é‡‘æµé‡æ¯”ç‡")
                fig, fig2, avg_price_to_cash_flow_ratio = plotly_cfr_3(dfs)
                st.write('''
                    ç¾é‡‘æµé‡æ¯”ç‡ï¼Œç‡Ÿæ¥­æ´»å‹•çš„ç¾é‡‘æµå…¥ï¼Œæ˜¯å¦è¶³ä»¥å› æ‡‰ç©æ¬ çš„æµå‹•è² å‚µï¼Œ  
                    æ¯”ç‡è¶Šé«˜ï¼ŒçŸ­æœŸå„Ÿå‚µèƒ½åŠ›è¶Šå¥½ï¼Œé«˜æ–¼100%ï¼Œå…¬å¸çš„ç¾é‡‘æµé‡èƒ½å¤ è¦†è“‹å…¨éƒ¨çš„æµå‹•è² å‚µ  
                    å…¬å¼:  
                        ç‡Ÿæ¥­æ´»å‹•æ·¨ç¾é‡‘æµé‡ / æµå‹•è² å‚µ *100 (%)
                            ''')
                st.plotly_chart(fig) 
                if avg_price_to_cash_flow_ratio < 100:
                    st.write(f'è¿‘å››å­£å¹³å‡ç¾é‡‘æµé‡æ¯”ç‡ç‚º{avg_price_to_cash_flow_ratio}%ï¼Œä½æ–¼100%ï¼Œè«‹èˆ‡åŒæ¥­æ¯”è¼ƒ')
                else:
                    st.write(f'è¿‘å››å­£å¹³å‡ç¾é‡‘æµé‡æ¯”ç‡ç‚º{avg_price_to_cash_flow_ratio}%ï¼Œä¸éŒ¯ï¼Œå¯ä»¥èˆ‡åŒæ¥­æ¯”è¼ƒ')
                st.plotly_chart(fig2)
        except:
            pass



        try:
            # 005 åŒ…æˆdef 
            # ç¾é‡‘ä½”æ¯”è¶¨å‹¢
            # éŠ€è¡Œæ¥­ok 
            st.markdown("#### â˜… ç¾é‡‘ä½”æ¯”è¶¨å‹¢")
            fig, fig2, avg_cashncash_equivalents = plotly_cashncash_equivalents(dfs)
            st.write('''
                å…¬å¸åœ¨çŸ­æœŸå…§æ“æœ‰å¤šå°‘ç¾é‡‘è³‡ç”¢ï¼Œèˆ‡åŒæ¥­æ¯”ï¼Œæœ€å¥½è¦æœ‰10~25%ï¼Œè³‡æœ¬å¯†é›†è¡Œæ¥­è¦æ›´é«˜ï¼Œé‡‘èæ¥­æœƒè¼ƒä½  
                å…¬å¼:  
                    ç¾é‡‘èˆ‡ç´„ç•¶ç¾é‡‘ / è³‡ç”¢ç¸½é¡ *100 (%)
                        ''')
            st.plotly_chart(fig)
            if avg_cashncash_equivalents < 10:
                st.write(f'è¿‘å››å­£å¹³å‡ç¾é‡‘ä½”æ¯”ç‚º{avg_cashncash_equivalents}%ï¼Œä½æ–¼10%ï¼Œè«‹èˆ‡åŒæ¥­æ¯”è¼ƒ')
            elif avg_cashncash_equivalents <= 25:
                st.write(f'è¿‘å››å­£å¹³å‡ç¾é‡‘ä½”æ¯”ç‚º{avg_cashncash_equivalents}%ï¼Œåˆç†ç¯„åœå…§ï¼Œè«‹èˆ‡åŒæ¥­æ¯”è¼ƒ')
            else:
                st.write(f'è¿‘å››å­£å¹³å‡ç¾é‡‘ä½”æ¯”ç‚º{avg_cashncash_equivalents}%ï¼Œå¾ˆä¸éŒ¯ï¼Œå¯ä»¥èˆ‡åŒæ¥­æ¯”è¼ƒ')

            st.plotly_chart(fig2)

        except:
            pass
        
        ##########################
        st.subheader("")
        # st.markdown("<a name='ã€ç¶“ç‡Ÿèƒ½åŠ›ã€‘'></a>", unsafe_allow_html=True)
        st.subheader("ã€ç¶“ç‡Ÿèƒ½åŠ›ã€‘")
        

        
        try:
            # 007 åŒ…æˆdef
            # æ‡‰æ”¶å¸³æ¬¾ã€å­˜è²¨å‘¨è½‰ã€æ‡‰ä»˜å¸³æ¬¾ã€ç¸½è³‡ç”¢å‘¨è½‰ã€ç¾é‡‘ä½”æ¯”
            # éŠ€è¡Œæ¥­ä¸çœ‹
            if stock_industry == "ç”¢æ¥­åˆ¥ï¼šé‡‘èä¿éšªæ¥­ï¼ˆå…¶ä¸­é‡‘æ§å…¬å¸ä¿‚æ§è‚¡å…¬å¸ï¼Œå…¶ç”³å ±ä¹‹ã€Œç‡Ÿæ¥­æ”¶å…¥ã€ä¿‚èªåˆ—æ‰€æœ‰å­å…¬å¸æç›Šä¹‹åˆè¨ˆæ•¸ï¼‰" or stock_industry == "ç”¢æ¥­åˆ¥ï¼šé‡‘èæ¥­":
                pass
            else:
                st.markdown("#### â˜… ç¸½è³‡ç”¢ã€å­˜è²¨ã€æ‡‰æ”¶ã€æ‡‰ä»˜å¸³æ¬¾é€±è½‰ç‡")
                fig, fig2, fig22, fig3, fig4 = plotly_days_sales_outstanding(dfs)
                st.write('''
                    ç¸½è³‡ç”¢å‘¨è½‰>1æ¬¡ï¼Œæ‰æœ‰è³ºï¼›è‹¥<1ï¼Œå¤šæ•¸æ˜¯è³‡æœ¬å¯†é›†ã€ç‰¹æ®Šè¡Œæ¥­ï¼ŒåŠå°é«”ã€ç²¾å“ã€ç¶²è·¯ã€é‡‘è...  
                    è¦æ³¨æ„ç¾é‡‘ä½”æ¯”æ˜¯å¦è¶³å¤ ï¼Œæœ€å¥½10~25%ï¼Œæˆ–æ›´å¤šï¼Œæˆ–æ‡‰æ”¶å¸³æ¬¾å¤©æ•¸è¼ƒçŸ­(<15å¤©)ã€å­˜è²¨å¤©æ•¸è¼ƒçŸ­(<60å¤©)  
                    å…¬å¼:  
                        ç¸½è³‡ç”¢é€±è½‰ = ç‡Ÿæ¥­æ”¶å…¥ / å¹³å‡è³‡ç”¢ç¸½é¡   
                        å­˜è²¨é€±è½‰ç‡ = ç‡Ÿæ¥­æˆæœ¬ / å¹³å‡å­˜è²¨  
                        æ‡‰æ”¶å¸³æ¬¾é€±è½‰ç‡ = ç‡Ÿæ¥­æ”¶å…¥ / å¹³å‡æ‡‰æ”¶å¸³æ¬¾æ·¨é¡  
                        æ‡‰ä»˜å¸³æ¬¾é€±è½‰ç‡ = ç‡Ÿæ¥­æˆæœ¬ / å¹³å‡æ‡‰ä»˜å¸³æ¬¾æ·¨é¡               
                            ''')
                st.plotly_chart(fig) 
                st.write('''
                    å­˜è²¨å‘¨è½‰>6æ¬¡/å¹´ï¼Œå°±å¾ˆä¸éŒ¯  
                    æ‡‰æ”¶å¸³æ¬¾<15å¤©ç‚ºæ”¶ç¾é‡‘è¡Œæ¥­ã€B2Bé€šå¸¸ç‚º60~90å¤©ï¼Œèˆ‡åŒæ¥­æ¯”è¼ƒ 
                            ''')
                st.plotly_chart(fig2)
                st.plotly_chart(fig22) 
                st.write('''
                    æ‡‰ä»˜å¸³æ¬¾å¤©æ•¸è¦å¹³ç©©æˆ–ä¸Šå‡ï¼Œä»˜è¶Šå°‘æ¬¡è¶Šå¥½  
                    å­˜è²¨å¤©æ•¸è¦å¹³ç©©æˆ–ä¸‹é™ï¼Œåœ¨åº«å¤©æ•¸è¶Šå°‘è¶Šå¥½  
                    æ‡‰æ”¶å¸³æ¬¾å¤©æ•¸è¦å¹³ç©©æˆ–ä¸‹é™ï¼Œæ”¶è¶Šå¤šæ¬¡è¶Šå¥½  
                            ''')
                st.write('''
                    åšç”Ÿæ„å®Œæ•´é€±æœŸ>200å¤©ï¼Œç¾é‡‘è¦è¶³å¤ ï¼Œæ¯›åˆ©è¦é«˜  
                    å…¬å¼:  
                        åšç”Ÿæ„å®Œæ•´é€±æœŸ = å­˜è²¨å¤©æ•¸+æ‡‰æ”¶å¸³æ¬¾å¤©æ•¸
                            ''')
                st.plotly_chart(fig3)
                st.write('''
                    ç¾é‡‘é€±è½‰å¤©æ•¸ï¼Œè¦å¹³ç©©æˆ–ç·©æ…¢ä¸‹é™ï¼Œç¾é‡‘å£“åŠ›è®Šå°  
                    å…¬å¼:  
                        ç¾é‡‘é€±è½‰å¤©æ•¸ = å­˜è²¨å¤©æ•¸+æ‡‰æ”¶å¸³æ¬¾å¤©æ•¸-æ‡‰ä»˜å¸³æ¬¾å¤©æ•¸
                            ''')
                st.plotly_chart(fig4)
        except:
            pass
 
        
        
        try:
            # 007-2 åŒ…æˆdef
            # (è‹¥æ˜¯æœ‰å‡å…¬å¸è²¡å ±ï¼Œè§€å¯Ÿæ‡‰æ”¶å¸³æ¬¾å¤©æ•¸ã€æ‡‰æ”¶å¸³æ¬¾ä½”ç¸½è³‡ç”¢æ¯”ç‡ã€å­˜è²¨å¤©æ•¸ã€å­˜è²¨ä½”ç¸½è³‡ç”¢æ¯”ç‡ï¼Œæ˜¯å¦æ€¥é½å¢åŠ 
            # ç‡Ÿæ¥­æ”¶å…¥ã€æ·¨åˆ©æˆé•·ï¼Œä½†OCFä¸€ç›´æ”¶ä¸åˆ°ç¾é‡‘ï¼Œç¾é‡‘èˆ‡ç´„ç•¶ç¾é‡‘æ²’æˆé•·)
            # éŠ€è¡Œæ¥­ä¸çœ‹
            if stock_industry == "ç”¢æ¥­åˆ¥ï¼šé‡‘èä¿éšªæ¥­ï¼ˆå…¶ä¸­é‡‘æ§å…¬å¸ä¿‚æ§è‚¡å…¬å¸ï¼Œå…¶ç”³å ±ä¹‹ã€Œç‡Ÿæ¥­æ”¶å…¥ã€ä¿‚èªåˆ—æ‰€æœ‰å­å…¬å¸æç›Šä¹‹åˆè¨ˆæ•¸ï¼‰" or stock_industry == "ç”¢æ¥­åˆ¥ï¼šé‡‘èæ¥­":
                pass
            else:
                st.markdown("#### â˜… å‡è¨­æœ‰é–“å‡å…¬å¸è²¡å ±")
                fig, fig2 = plotly_fake(dfs)
                st.write('''
                    è§€å¯Ÿæ‡‰æ”¶å¸³æ¬¾å¤©æ•¸ã€æ‡‰æ”¶å¸³æ¬¾ä½”ç¸½è³‡ç”¢æ¯”ç‡ã€å­˜è²¨å¤©æ•¸ã€å­˜è²¨ä½”ç¸½è³‡ç”¢æ¯”ç‡ï¼Œæ˜¯å¦æ€¥é½å¢åŠ ï¼›  
                    ç‡Ÿæ¥­æ”¶å…¥ã€æ·¨åˆ©æˆé•·ï¼Œä½†OCFä¸€ç›´æ”¶ä¸åˆ°ç¾é‡‘ï¼Œç¾é‡‘èˆ‡ç´„ç•¶ç¾é‡‘æ²’æˆé•·
                            ''')
                st.plotly_chart(fig)
                st.plotly_chart(fig2) 
        except:
            pass
        
        
        
        try:
            # 008 åŒ…æˆdef
            # ä¸å‹•ç”¢ã€å» æˆ¿åŠè¨­å‚™é€±è½‰ç‡ Fixed Asset Turnover Ratio
            # éŠ€è¡Œæ¥­ok (æ”¹æˆåˆ©æ¯æ”¶å…¥/å¹³å‡ä¸å‹•ç”¢ã€å» æˆ¿åŠè¨­å‚™æ·¨é¡)ã€æ²’æœ‰ä¸å‹•ç”¢å°±ä¸é¡¯ç¤º
            
            if stock_industry == "ç”¢æ¥­åˆ¥ï¼šé‡‘èä¿éšªæ¥­ï¼ˆå…¶ä¸­é‡‘æ§å…¬å¸ä¿‚æ§è‚¡å…¬å¸ï¼Œå…¶ç”³å ±ä¹‹ã€Œç‡Ÿæ¥­æ”¶å…¥ã€ä¿‚èªåˆ—æ‰€æœ‰å­å…¬å¸æç›Šä¹‹åˆè¨ˆæ•¸ï¼‰" or stock_industry == "ç”¢æ¥­åˆ¥ï¼šé‡‘èæ¥­":
                st.markdown("#### â˜… åˆ©æ¯æ”¶å…¥/å¹³å‡ä¸å‹•ç”¢ã€å» æˆ¿åŠè¨­å‚™é€±è½‰ç‡")
                try:
                    fig01, fig02 = plotly_fixed_asset_turnover_ratio(dfs)
                    st.write('''
                    ä¸å‹•ç”¢ã€å» æˆ¿åŠè¨­å‚™é€±è½‰ç‡è¶Šé«˜ï¼Œå…¬å¸æ›´èƒ½æœ‰æ•ˆåœ°åˆ©ç”¨è¨­å‚™ä¾†ç”¢ç”Ÿæ·¨æ”¶ç›Šï¼Œä½†ä¹Ÿå¯èƒ½ä»£è¡¨å…¬å¸æ©Ÿå°ï¼Œæ²’è·Ÿä¸Šæ¥­å‹™çš„è¿…é€Ÿæˆé•·  
                    ç·©æ…¢ä¸Šå‡ï¼Œè¡¨ç¤ºä¸å‹•ç”¢ã€å» æˆ¿åŠè¨­å‚™åˆ©ç”¨æ•ˆç‡ä¸Šå‡ï¼Œç”¢å“å–®ä½æˆæœ¬ä¸‹é™ï¼Œç²åˆ©èƒ½åŠ›æå‡  
                    PS è¨˜å¾—çœ‹ç”¢æ¥­ç‰¹æ€§ï¼Œé›»å­æ”¯ä»˜é¡çš„å…¬å¸æ•¸å€¼æœƒåä½  
                    å…¬å¼:  
                        åˆ©æ¯æ”¶å…¥ / å¹³å‡ä¸å‹•ç”¢ã€å» æˆ¿åŠè¨­å‚™
                            ''')
                    st.plotly_chart(fig01)
                    st.plotly_chart(fig02) 
                except:
                    pass
                
            else:
                st.markdown("#### â˜… ä¸å‹•ç”¢ã€å» æˆ¿åŠè¨­å‚™é€±è½‰ç‡")
                fig, fig2 = plotly_fixed_asset_turnover_ratio(dfs)
                st.write('''
                    ä¸å‹•ç”¢ã€å» æˆ¿åŠè¨­å‚™é€±è½‰ç‡è¶Šé«˜ï¼Œå…¬å¸æ›´èƒ½æœ‰æ•ˆåœ°åˆ©ç”¨è¨­å‚™ä¾†ç”¢ç”Ÿæ·¨æ”¶ç›Šï¼Œä½†ä¹Ÿå¯èƒ½ä»£è¡¨å…¬å¸æ©Ÿå°ï¼Œæ²’è·Ÿä¸Šæ¥­å‹™çš„è¿…é€Ÿæˆé•·  
                    ç·©æ…¢ä¸Šå‡ï¼Œè¡¨ç¤ºä¸å‹•ç”¢ã€å» æˆ¿åŠè¨­å‚™åˆ©ç”¨æ•ˆç‡ä¸Šå‡ï¼Œç”¢å“å–®ä½æˆæœ¬ä¸‹é™ï¼Œç²åˆ©èƒ½åŠ›æå‡  
                    *è¨˜å¾—çœ‹ç”¢æ¥­ç‰¹æ€§ï¼Œé›»å­æ”¯ä»˜é¡çš„å…¬å¸æ•¸å€¼æœƒåä½  
                    å…¬å¼: ç‡Ÿæ¥­æ”¶å…¥ / å¹³å‡ä¸å‹•ç”¢ã€å» æˆ¿åŠè¨­å‚™
                            ''')
                st.plotly_chart(fig)
                st.plotly_chart(fig2) 
        except:
            pass
        
        
        ##########################
        st.subheader("")
        # st.markdown("<a name='ã€ç²åˆ©èƒ½åŠ›ã€‘'></a>", unsafe_allow_html=True)
        st.subheader("ã€ç²åˆ©èƒ½åŠ›ã€‘")
  


        try:
            # 005 åŒ…æˆdef
            # ROE
            # éŠ€è¡Œæ¥­ok
            st.markdown("#### â˜… ROE æ¬Šç›Šå ±é…¬ç‡")
            fig, fig2, avg_roe = plotly_roe(dfs)
            st.write('''  
                ROEæ¬Šç›Šå ±é…¬ç‡è¶Šé«˜ï¼Œä»£è¡¨å…¬å¸è¶Šèƒ½å¦¥å–„é‹ç”¨è³‡æºï¼Œç‚ºè‚¡æ±è³ºå›çš„ç²åˆ©è¶Šé«˜  
                èˆ‡åŒæ¥­æ¯”ï¼Œé€šå¸¸ ROE > 10-15ï¼… (ä¸‰åˆ°äº”å¹´å¹³å‡ã€é€£çºŒäº”å¹´)ä½œç‚ºé¸è‚¡æ¢ä»¶      
                *ROEé«˜ï¼Œè¨˜å¾—è¦è§€å¯Ÿæ·¨åˆ©å’Œè²¡å‹™æ§“æ¡¿ï¼Œæœ‰å¯èƒ½æ˜¯æ·¨åˆ©é«˜ï¼Œæˆ–æ˜¯è²¡å‹™æ§“æ¡¿é«˜ã€è‚¡æœ¬å°  
                å…¬å¼:  
                    ç¨…å¾Œæ·¨åˆ© / å¹³å‡æ¬Šç›Šç¸½é¡ *100 (%)            
                        ''')
            st.plotly_chart(fig)
            if avg_roe > 15:
                st.write(f'è¿‘å››å­£ç´¯è¨ˆROEç‚ºï¼š{avg_roe}%ï¼Œå¾ˆä¸éŒ¯ï¼Œå¯ä»¥èˆ‡åŒæ¥­æ¯”è¼ƒ')
            elif avg_roe > 10 and avg_roe < 15 :
                st.write(f'è¿‘å››å­£ç´¯è¨ˆROEç‚ºï¼š{avg_roe}%ï¼Œåœ¨åˆç†ç¯„åœå…§ï¼Œå¯ä»¥èˆ‡åŒæ¥­æ¯”è¼ƒ')
            else:
                st.write(f'è¿‘å››å­£ç´¯è¨ˆROEç‚ºï¼š{avg_roe}%ï¼Œåä½ï¼Œè«‹èˆ‡åŒæ¥­æ¯”è¼ƒ')
            st.plotly_chart(fig2)
        except:
            pass
        
        
        
        try:
            # 006 åŒ…æˆdef
            # ROA
            # éŠ€è¡Œæ¥­ok
            st.markdown("#### â˜… ROA è³‡ç”¢å ±é…¬ç‡")
            fig, fig2, avg_roa = plotly_roa(dfs)
            st.write('''
                ROAè³‡ç”¢å ±é…¬ç‡è¶Šé«˜ï¼Œä»£è¡¨æ•´é«”è³‡ç”¢å¸¶å›çš„ç²åˆ©è¶Šé«˜ï¼Œè² å‚µæ¯”ç‡è¼ƒé«˜çš„ç”¢æ¥­ï¼Œé‡‘èã€ä¿éšªæ¥­å¸¸ç”¨ROA  
                èˆ‡åŒæ¥­æ¯”ï¼Œé€šå¸¸ ROA > 6-7ï¼… (ä¸‰åˆ°äº”å¹´å¹³å‡ã€é€£çºŒäº”å¹´ç­‰) ä½œç‚ºé¸è‚¡æ¢ä»¶  
                *å¦‚æœROAå¾ˆä½ï¼Œä½†ROEå¾ˆé«˜ï¼Œå…¬å¸ç²åˆ©å¯èƒ½å¤§éƒ¨åˆ†ä¾†è‡ªé«˜è²¡å‹™æ§“æ¡¿ï¼Œé¢¨éšªä¹Ÿè¼ƒé«˜  
                å…¬å¼:  
                    ç¨…å¾Œæ·¨åˆ© / å¹³å‡è³‡ç”¢ç¸½é¡  *100 (%) (æœªå«åˆ©æ¯åŠæ‰£ç¨…)
                        ''')
            st.plotly_chart(fig)
            if avg_roa > 7:
                st.write(f'è¿‘å››å­£ç´¯è¨ˆROAç‚ºï¼š{avg_roa}%ï¼Œå¾ˆä¸éŒ¯ï¼Œå¯ä»¥èˆ‡åŒæ¥­æ¯”è¼ƒ')
            elif avg_roa > 5 and avg_roa < 7 :
                st.write(f'è¿‘å››å­£ç´¯è¨ˆROAç‚ºï¼š{avg_roa}%ï¼Œåœ¨åˆç†ç¯„åœå…§ï¼Œå¯ä»¥èˆ‡åŒæ¥­æ¯”è¼ƒ')
            else:
                st.write(f'è¿‘å››å­£ç´¯è¨ˆROAç‚ºï¼š{avg_roa}%ï¼Œåä½ï¼Œè«‹èˆ‡åŒæ¥­æ¯”è¼ƒ')
            st.plotly_chart(fig2)
        except:
            pass    
        
        
        try:
            # 007-2 åŒ…æˆdef
            # æœˆå ±çœ‹æ¯æœˆç‡Ÿæ”¶
            # éŠ€è¡Œæ¥­ok
            st.markdown("#### â˜… æœˆç‡Ÿæ”¶æ¯”è¼ƒ")
            fig= read__monthly_report_from_sqlite(stock_code)
            st.write('''
                å­£å ±é‚„æœªå‡ºä¾†æ™‚ï¼Œå¯ä»¥è§€å¯Ÿæ¯æœˆç‡Ÿæ”¶ã€èˆ‡å»å¹´ç•¶æœˆç‡Ÿæ”¶æ¯”è¼ƒï¼Œä¸¦åƒè€ƒEPS  
                å‡è¨­æœ‰å…¬å¸æœˆç‡Ÿæ”¶ã€EPSéƒ½ä½ï¼Œä½†ç‡Ÿæ¥­æ´»å‹•ç¾é‡‘æµé«˜ï¼Œå¯èƒ½ç‡Ÿæ¥­æˆæœ¬é™ä½ã€æ¸›å°‘è³‡æœ¬æ”¯å‡ºã€åŠ å¿«æ‡‰æ”¶å¸³æ¬¾é€±è½‰...  
                *ç›´æ¥æ‹–æ‹‰å¯ä»¥æ”¾å¤§ï¼Œå³ä¸Šè§’ğŸ›ï¸å¯ä»¥é‡ç½®
                        ''')
            st.plotly_chart(fig)
        except:
            pass
        
        
        
        
        try:
            # 007 åŒ…æˆdef
            # eps
            # éŠ€è¡Œæ¥­ok
            st.markdown("#### â˜… EPS")
            fig, fig2, fig3 = plotly_eps(dfs)
            st.write('''
                æ¯è‚¡ç›ˆé¤˜ï¼ˆEarnings Per Shareï¼‰  
                æ˜¯ä¸€å€‹è¡¡é‡å…¬å¸ç›ˆåˆ©èƒ½åŠ›çš„è²¡å‹™æŒ‡æ¨™ï¼Œç”¨æ–¼è©•ä¼°å…¬å¸åœ¨æ¯è‚¡æ™®é€šè‚¡ä¸Šå¯¦ç¾çš„ç›ˆåˆ©æƒ…æ³  
                å…¬å¼:  
                    æç›Šè¡¨ä¸­çš„ã€ŒåŸºæœ¬æ¯è‚¡ç›ˆé¤˜ã€ï¼ŒQ4å–®å­£ç‚ºå…¨å¹´åº¦-(Q1+Q2+Q3)
                        ''')
            st.plotly_chart(fig)
            st.plotly_chart(fig2)
            st.plotly_chart(fig3)
        except:
            pass   
        
        
        
        
        try:
            # ç¶œåˆæç›Šè¡¨ (ç²åˆ©èƒ½åŠ›)
            # 001~004 åŒ…æˆdef
            # è²¡å ±ä¸‰ç‡
            # éŠ€è¡Œæ¥­ok
            st.markdown("#### â˜… è²¡å ±ä¸‰ç‡: æ¯›åˆ©ç‡ã€ç‡Ÿç›Šç‡ã€æ·¨åˆ©ç‡")
            fig, fig2, fig3 = plotly_3_rate(dfs)
            st.write('''
                ç‡Ÿç›Šç‡ > æ·¨åˆ©ç‡ï¼Œå…¬å¸åœ¨ç‡Ÿæ¥­æ´»å‹•ä¸­æœ‰è¼ƒé«˜çš„æ•ˆç‡ï¼Œæœ‰æ•ˆåœ°ç®¡ç†ç‡Ÿé‹æˆæœ¬å’Œç‡Ÿæ¥­è²»ç”¨  
                ç‡Ÿç›Šç‡ < æ·¨åˆ©ç‡ï¼Œå…¬å¸åœ¨ç‡Ÿæ¥­æ”¯å‡ºä¸Šæœ‰è¼ƒå¤šçš„é–‹æ”¯  
                è²»ç”¨ç‡èˆ‡åŒæ¥­æ¯”ï¼Œè¶Šä½é€šå¸¸è¦æ¨¡è¶Šå¤§  
                è²»ç”¨ç‡èˆ‡åŒæ¥­æ¯”è¼ƒï¼Œå“ç‰Œå•†é€šå¸¸æœƒ>20%ï¼Œå¯¦é«”é€šè·¯å› ç‚ºè¦å“¡å·¥ï¼Œé€šå¸¸æœƒ>ç¶²è·¯é€šè·¯  
                å…¬å¼:  
                    æ¯›åˆ©ç‡ = (ç‡Ÿæ¥­æ”¶å…¥-ç‡Ÿæ¥­æˆæœ¬) / ç‡Ÿæ¥­æ”¶å…¥ *100 (%)  
                    ç‡Ÿç›Šç‡ = ç‡Ÿæ¥­åˆ©ç›Š / ç‡Ÿæ¥­æ”¶å…¥ *100 (%)  
                    è²»ç”¨ç‡ = æ¯›åˆ©ç‡ - ç‡Ÿç›Šç‡  
                    æ·¨åˆ©ç‡ = ç¨…å¾Œæ·¨åˆ© / ç‡Ÿæ¥­æ”¶å…¥ *100 (%)
                        ''')
            st.plotly_chart(fig)
            st.plotly_chart(fig2)
            st.plotly_chart(fig3)
        except:
            pass
        
        
        
        try:
            # 004-2 åŒ…æˆdef
            # ç¶“ç‡Ÿå®‰å…¨é‚Šéš› (è¶Šé«˜ï¼ŒæŠµæŠ—æ™¯æ°£æ³¢å‹•èƒ½åŠ›è¶Šå¤§)
            # éŠ€è¡Œæ¥­ä¸çœ‹
            if stock_industry == "ç”¢æ¥­åˆ¥ï¼šé‡‘èä¿éšªæ¥­ï¼ˆå…¶ä¸­é‡‘æ§å…¬å¸ä¿‚æ§è‚¡å…¬å¸ï¼Œå…¶ç”³å ±ä¹‹ã€Œç‡Ÿæ¥­æ”¶å…¥ã€ä¿‚èªåˆ—æ‰€æœ‰å­å…¬å¸æç›Šä¹‹åˆè¨ˆæ•¸ï¼‰" or stock_industry == "ç”¢æ¥­åˆ¥ï¼šé‡‘èæ¥­":
                pass
            else:
                st.markdown("#### â˜… ç¶“ç‡Ÿå®‰å…¨é‚Šéš›")
                fig, fig2, avg_operating_margin_of_safety = plotly_operating_margin_of_safety(dfs)
                st.write('''
                    å…¬å¸åœ¨ç‡Ÿé‹æ–¹é¢çš„ç©©å®šæ€§å’ŒæŠµæŠ—æ™¯æ°£æ³¢å‹•çš„èƒ½åŠ›ï¼Œ>60%å¾ˆä¸éŒ¯ï¼Œæ•¸å€¼è¶Šé«˜ï¼ŒæŠµæŠ—æ™¯æ°£æ³¢å‹•èƒ½åŠ›è¶Šå¤§  
                    å…¬å¼:  
                        ç‡Ÿæ¥­åˆ©ç›Š / ç‡Ÿæ¥­æ¯›åˆ© *100 (%)
                            ''')
                st.plotly_chart(fig)
                if avg_operating_margin_of_safety < 50:
                    st.write(f'è¿‘å››å­£å¹³å‡ç¶“ç‡Ÿå®‰å…¨é‚Šéš›ç‚º{avg_operating_margin_of_safety}%ï¼Œåä½ï¼Œè«‹èˆ‡åŒæ¥­æ¯”è¼ƒ')
                else:
                    st.write(f'è¿‘å››å­£å¹³å‡ç¶“ç‡Ÿå®‰å…¨é‚Šéš›ç‚º{avg_operating_margin_of_safety}%ï¼Œä¸éŒ¯ï¼Œå¯ä»¥èˆ‡åŒæ¥­æ¯”è¼ƒ')

                st.plotly_chart(fig2)
        except:
            pass
        
        
        
        try:
            # 005åŒ…æˆdef
            # ç‡Ÿæ”¶ã€ç›ˆé¤˜ã€ç‡Ÿç›Šç‡æ¯”è¼ƒ
            # éŠ€è¡Œæ¥­ok 
            st.markdown("#### â˜… ç‡Ÿæ”¶ã€ç›ˆé¤˜ã€ç‡Ÿç›Šç‡æ¯”è¼ƒ")
            fig, fig2 = plotly_year_revenue(dfs)
            st.write('''
                ç•¶ç‡Ÿæ”¶æˆé•·æ™‚ï¼Œç›ˆé¤˜ã€ç‡Ÿç›Šç‡åŒæ­¥æˆé•·ï¼Œæ‰æ˜¯é æœ¬æ¥­è³ºéŒ¢çš„å…¬å¸ï¼Œç”¨"ç‡Ÿç›Šç‡%"è§€å¯Ÿæœ¬æ¥­ç›ˆé¤˜è®ŠåŒ–  
                        ''')
            st.plotly_chart(fig)
            st.plotly_chart(fig2)
        except:
            pass   
    
        
        
        try:
            # 005-2 åŒ…æˆdef
            # ç‡Ÿæ”¶æˆé•·ç‡ Revenue Growth Rate # å­£
            # éŠ€è¡Œæ¥­ok 
            st.markdown("#### â˜… ç‡Ÿæ”¶æˆé•·ç‡æ¯”è¼ƒ")
            try:
                fig, fig2, fig33 = plotly_4q_revenue_growth_rate(dfs)
            except:
                fig, fig2 = plotly_4q_revenue_growth_rate(dfs)

            st.plotly_chart(fig)
            st.plotly_chart(fig2)
            try:
                st.plotly_chart(fig33)
            except:
                pass
        except:
            pass
    

        
        
        try:
            # 006 åŒ…æˆdef
            # æ¥­å…§ã€æ¥­å¤–
            # éŠ€è¡Œæ¥­ä¸çœ‹
            if stock_industry == "ç”¢æ¥­åˆ¥ï¼šé‡‘èä¿éšªæ¥­ï¼ˆå…¶ä¸­é‡‘æ§å…¬å¸ä¿‚æ§è‚¡å…¬å¸ï¼Œå…¶ç”³å ±ä¹‹ã€Œç‡Ÿæ¥­æ”¶å…¥ã€ä¿‚èªåˆ—æ‰€æœ‰å­å…¬å¸æç›Šä¹‹åˆè¨ˆæ•¸ï¼‰" or stock_industry == "ç”¢æ¥­åˆ¥ï¼šé‡‘èæ¥­":
                pass
            else:
                st.markdown("#### â˜… æ¥­å…§ã€æ¥­å¤–ä½”æ¯”ã€æ¥­å¤–è²¢ç»æ¯”")
                st.write('''
                å…¬å¼:  
                    æ¥­å…§ = ç‡Ÿæ¥­åˆ©ç›Š / (ç‡Ÿæ¥­åˆ©ç›Š+ç‡Ÿæ¥­å¤–æ”¶å…¥åŠæ”¯å‡º)  
                    æ¥­å¤– = ç‡Ÿæ¥­å¤–æ”¶å…¥åŠæ”¯å‡º / (ç‡Ÿæ¥­åˆ©ç›Š+ç‡Ÿæ¥­å¤–æ”¶å…¥åŠæ”¯å‡º)  
                    æ¥­å¤–è²¢ç»æ¯”ï¼Œæ¥­å¤–æ”¶å…¥å°ç¸½ç²åˆ©çš„è²¢ç»æ¯”ä¾‹ = ç¨…å‰æ·¨åˆ© / ç‡Ÿæ¥­åˆ©ç›Š
                        ''')
                fig, fig2 = plotly_non_operating_earnings(dfs)
                st.plotly_chart(fig)
                st.plotly_chart(fig2)
        except:
            pass    
            
        
        
        try:
            # 010 åŒ…æˆdef
            # è³¦ç¨…å„ªå‹¢
            # éŠ€è¡Œæ¥­ok
            st.markdown("#### â˜… è³¦ç¨…å„ªå‹¢")
            fig, fig2 = plotly_tax(dfs)
            st.write('''
                èˆ‡åŒæ¥­æ¯”ï¼Œè¶Šé«˜è¶Šå¥½ï¼Œè¡¨ç¤ºå…¬å¸æœ‰è¼ƒå¥½çš„è³¦ç¨…å„ªå‹¢ï¼Œèƒ½å¤ æœ‰æ•ˆåœ°é™ä½æ‡‰ç¹³ç´çš„æ‰€å¾—ç¨…ï¼Œæé«˜ç¨…å¾Œæ·¨åˆ©  
                å…¬å¼:  
                    ç¨…å¾Œæ·¨åˆ© / ç¨…å‰æ·¨åˆ©
                        ''')
            st.plotly_chart(fig)
            st.plotly_chart(fig2)
        except:
            pass
        
        
        
        ##########################
        st.subheader("")
        # st.markdown("<a name='ã€è²¡å‹™çµæ§‹ã€‘'></a>", unsafe_allow_html=True)
        st.subheader("ã€è²¡å‹™çµæ§‹ã€‘")
        
        
        try:
            # 001 åŒ…æˆdef
            # è³‡ç”¢è² å‚µæ¯”ç‡ Debt to Asset Ratio
            # éŠ€è¡Œæ¥­ok
            st.markdown("#### â˜… è³‡ç”¢è² å‚µæ¯”ç‡")
            fig, fig2, avg_debt_to_asset_ratio = plotly_debt_to_asset_ratio(dfs)
            st.write('''
                è² å‚µæ¯”ç‡è¶Šä½ï¼Œä»£è¡¨è‚¡æ±æ¬Šç›Šè¼ƒé«˜ï¼Œè‚¡æ±å°å…¬å¸è¶Šæœ‰ä¿¡å¿ƒï¼Œå…¬å¸çš„é¢¨éšªå°±è¶Šå°  
                è² å‚µæ¯”ç‡è¶Šé«˜ï¼Œä»£è¡¨å…¬å¸ä½¿ç”¨æ›´å¤šçš„å‚µå‹™è³‡é‡‘ï¼Œå¯èƒ½å¢åŠ äº†è²¡å‹™é¢¨éšªï¼Œä½†ä¹Ÿå¯èƒ½æé«˜äº†æ½›åœ¨çš„æ”¶ç›Š  
                èˆ‡åŒæ¥­æ¯”ï¼Œé€šå¸¸ä¸é«˜æ–¼50%~60% (éŠ€è¡Œä¿éšªå£½éšªã€ç‡Ÿå»ºæ¥­æœƒè¼ƒé«˜)  
                å…¬å¼:  
                    è² å‚µç¸½é¡ / è³‡ç”¢ç¸½é¡ *100 (%)
                        ''')
            st.plotly_chart(fig)
            if avg_debt_to_asset_ratio > 60:
                st.write(f'è¿‘å››å­£å¹³å‡è³‡ç”¢è² å‚µæ¯”ç‚ºï¼š{avg_debt_to_asset_ratio}%ï¼Œåé«˜ï¼Œè«‹èˆ‡åŒæ¥­æ¯”è¼ƒ')
            elif avg_debt_to_asset_ratio > 40 and avg_debt_to_asset_ratio < 60 :
                st.write(f'è¿‘å››å­£å¹³å‡è³‡ç”¢è² å‚µæ¯”ç‚ºï¼š{avg_debt_to_asset_ratio}%ï¼Œåœ¨åˆç†ç¯„åœå…§ï¼Œå¯ä»¥èˆ‡åŒæ¥­æ¯”è¼ƒ')
            else:
                st.write(f'è¿‘å››å­£å¹³å‡è³‡ç”¢è² å‚µæ¯”ç‚ºï¼š{avg_debt_to_asset_ratio}%ï¼Œåä½ï¼Œå‚µå‹™æ¯”ç‡æ§ç®¡å¾—ç•¶ï¼Œå¯ä»¥èˆ‡åŒæ¥­æ¯”è¼ƒ')
            st.plotly_chart(fig2)
        except:
            pass
        
        
        
        try:
            # 002 åŒ…æˆdef
            # é•·æœŸè³‡é‡‘ä½”ä¸å‹•ç”¢ã€å» æˆ¿åŠè¨­å‚™æ¯” Ratio of liabilities to assets
            # éŠ€è¡Œæ¥­ä¸çœ‹
            if stock_industry == "ç”¢æ¥­åˆ¥ï¼šé‡‘èä¿éšªæ¥­ï¼ˆå…¶ä¸­é‡‘æ§å…¬å¸ä¿‚æ§è‚¡å…¬å¸ï¼Œå…¶ç”³å ±ä¹‹ã€Œç‡Ÿæ¥­æ”¶å…¥ã€ä¿‚èªåˆ—æ‰€æœ‰å­å…¬å¸æç›Šä¹‹åˆè¨ˆæ•¸ï¼‰" or stock_industry == "ç”¢æ¥­åˆ¥ï¼šé‡‘èæ¥­":
                pass
            else:
                st.markdown("#### â˜… é•·æœŸè³‡é‡‘ä½”ä¸å‹•ç”¢ã€å» æˆ¿åŠè¨­å‚™æ¯”")
                fig, fig2, avg_ratio_of_liabilities_to_assets = plotly_ratio_of_liabilities_to_assets(dfs)
                st.write('''
                    é•·æœŸè³‡é‡‘ä½”å›ºå®šè³‡ç”¢æ¯”ç‡>1 ï¼Œç”¨é•·æœŸè³‡é‡‘ä¾†è²·ä¸å‹•ç”¢ã€å» æˆ¿åŠè¨­å‚™ï¼Œç›¸ç•¶å®‰å…¨  
                    é•·æœŸè³‡é‡‘ä½”å›ºå®šè³‡ç”¢æ¯”ç‡<1ï¼Œè²·ä¸å‹•ç”¢ã€å» æˆ¿åŠè¨­å‚™çš„éŒ¢å¾çŸ­æœŸè³‡é‡‘æ”¯ä»˜ï¼Œæ•¸å€¼éä½å¯èƒ½æœƒå°è‡´ç‡Ÿé‹é¢¨éšª   
                    å…¬å¼:  
                        (æ¬Šç›Šç¸½é¡ + éæµå‹•è² å‚µ) / ä¸å‹•ç”¢ã€å» æˆ¿åŠè¨­å‚™
                            ''')
                st.plotly_chart(fig)
                if avg_ratio_of_liabilities_to_assets > 1:
                    st.write(f'è¿‘å››å­£å¹³å‡é•·æœŸè³‡é‡‘ä½”ä¸å‹•ç”¢ã€å» æˆ¿åŠè¨­å‚™æ¯”ç‡ç‚ºï¼š{avg_ratio_of_liabilities_to_assets}å€ï¼Œç”¨é•·æœŸè³‡é‡‘ä¾†è²·å›ºå®šè³‡ç”¢ï¼Œç›¸ç•¶å®‰å…¨ï¼Œå¯ä»¥èˆ‡åŒæ¥­æ¯”è¼ƒ')
                else:
                    st.write(f'è¿‘å››å­£å¹³å‡é•·æœŸè³‡é‡‘ä½”ä¸å‹•ç”¢ã€å» æˆ¿åŠè¨­å‚™æ¯”ç‡ç‚ºï¼š{avg_ratio_of_liabilities_to_assets}å€ï¼Œåä½ï¼Œç”¨çŸ­æœŸè³‡é‡‘ä¾†è²·å›ºå®šè³‡ç”¢ï¼Œå¯ä»¥æœƒå°è‡´ç‡Ÿé‹é¢¨éšªï¼Œè«‹èˆ‡åŒæ¥­æ¯”è¼ƒ')
                st.plotly_chart(fig2)      
        except:
            pass        
            
        
        
        try:
            # 003 åŒ…æˆdef
            # ç¸½è² å‚µ/è‚¡æ±æ¬Šç›Šæ¯” Total Debt/Equity Ratioã€è²¡å‹™æ§“æ¡¿
            # éŠ€è¡Œæ¥­ok 
            st.markdown("#### â˜… ç¸½è² å‚µ/è‚¡æ±æ¬Šç›Šæ¯”")
            fig, fig2, avg_total_debt_equity_ratio = plotly_total_debt_equity_ratio(dfs)
            st.write('''
                æ•¸å­—è¶Šå°ï¼Œè¡¨ç¤ºå…¬å¸ç›¸å°æ“æœ‰è¼ƒé«˜çš„è³‡æœ¬è‡ªè¶³ç‡ï¼Œè‡ªæœ‰è³‡é‡‘å¤š  
                æ•¸å­—è¶Šå¤§ï¼Œå¯èƒ½å…¬å¸æ­£åœ¨æˆé•·ï¼Œä½†ç›¸å°åœ°ä½¿ç”¨äº†ä¸€å®šç¨‹åº¦çš„è²¡å‹™æ§“æ¡¿  
                å…¬å¼:  
                    (è² å‚µç¸½é¡ + æ¬Šç›Šç¸½é¡) / æ¬Šç›Šç¸½é¡ 
                        ''')
            st.plotly_chart(fig)
            if avg_total_debt_equity_ratio > 3:
                st.write(f'è¿‘å››å­£å¹³å‡è²¡å‹™æ§“æ¡¿ç‚ºï¼š{avg_total_debt_equity_ratio}å€ï¼Œåé«˜ï¼Œè«‹èˆ‡åŒæ¥­æ¯”è¼ƒ')
            else:
                st.write(f'è¿‘å››å­£å¹³å‡è²¡å‹™æ§“æ¡¿ç‚ºï¼š{avg_total_debt_equity_ratio}å€ï¼Œåœ¨åˆç†ç¯„åœå…§ï¼Œå¯ä»¥èˆ‡åŒæ¥­æ¯”è¼ƒ')
            st.plotly_chart(fig2)
        except:
            pass            
                    
                    
                
        ##########################
        st.subheader("")
        # st.markdown("<a name='ã€å„Ÿå‚µèƒ½åŠ›ã€‘'></a>", unsafe_allow_html=True)
        
        try:
            # 009 åŒ…æˆdef
            # å„Ÿå‚µèƒ½åŠ› debt-paying ability: æµå‹•ã€é€Ÿå‹•
            # éŠ€è¡Œæ¥­ä¸çœ‹
            if stock_industry == "ç”¢æ¥­åˆ¥ï¼šé‡‘èä¿éšªæ¥­ï¼ˆå…¶ä¸­é‡‘æ§å…¬å¸ä¿‚æ§è‚¡å…¬å¸ï¼Œå…¶ç”³å ±ä¹‹ã€Œç‡Ÿæ¥­æ”¶å…¥ã€ä¿‚èªåˆ—æ‰€æœ‰å­å…¬å¸æç›Šä¹‹åˆè¨ˆæ•¸ï¼‰" or stock_industry == "ç”¢æ¥­åˆ¥ï¼šé‡‘èæ¥­":
                pass
            else:
                st.subheader("ã€å„Ÿå‚µèƒ½åŠ›ã€‘")
                st.markdown("#### â˜… æµå‹•ã€é€Ÿå‹•æ¯”ç‡")
                fig, fig2, average_current_ratio, average_quick_ratio  = plotly_debt_paying_ability(dfs)
                
                st.write('''
                    æµå‹•æ¯”ç‡ã€é€Ÿå‹•æ¯”ç‡ï¼Œè¼•è³‡ç”¢è¡Œæ¥­æœƒåé«˜ï¼Œé‡è³‡ç”¢è¡Œæ¥­æœƒåä½  
                    æµå‹•æ¯”ç‡: å…¬å¸æ¯1å…ƒçš„æµå‹•è² å‚µï¼Œå¯ä»¥ç”¨å¤šå°‘å…ƒçš„æµå‹•è³‡ç”¢ä¾†é‚„å‚µ?  
                    (ä½æ¨™ç‚º1ï¼Œèˆ‡åŒæ¥­æ¯”ï¼Œé€šå¸¸è¦ 1.5-2.5)  
                    é€Ÿå‹•æ¯”ç‡: æ‰£é™¤å­˜è²¨å’Œé ä»˜è²»ç”¨ï¼Œå…¬å¸æ¯1å…ƒçš„æµå‹•è² å‚µï¼Œå¯ä»¥ç”¨å¤šå°‘å…ƒçš„æµå‹•è³‡ç”¢ä¾†é‚„å‚µ?  
                    (ä½æ¨™ç‚º1ï¼Œèˆ‡åŒæ¥­æ¯”ï¼Œé€šå¸¸è¦ 1-1.5)  
                    è‹¥æ˜¯é€Ÿå‹•æ¯”ç‡éä½ï¼Œç¾é‡‘èˆ‡ç´„ç•¶ç¾é‡‘æœ€å¥½æœ‰10%ä»¥ä¸Šã€æ‡‰æ”¶å¸³æ¬¾å¤©æ•¸<15å¤©ã€ç¸½è³‡ç”¢é€±è½‰ç‡>1  
                    å…¬å¼:  
                        æµå‹•æ¯”ç‡ = æµå‹•è³‡ç”¢ / æµå‹•è² å‚µ)   
                        é€Ÿå‹•æ¯”ç‡ = (æµå‹•è³‡ç”¢-å­˜è²¨-é ä»˜æ¬¾é …) / æµå‹•è² å‚µ
                            ''')
                st.plotly_chart(fig)
                if average_current_ratio < 1:
                    st.write(f'è¿‘å››å­£å¹³å‡æµå‹•æ¯”ç‚ºï¼š{average_current_ratio}ï¼Œä½æ–¼1ï¼Œè«‹èˆ‡åŒæ¥­æ¯”è¼ƒ')
                elif average_current_ratio > 1 and average_current_ratio < 1.5 :
                    st.write(f'è¿‘å››å­£å¹³å‡æµå‹•æ¯”ç‚ºï¼š{average_current_ratio}ï¼Œå¾®é«˜æ–¼ä½æ¨™ï¼Œè«‹èˆ‡åŒæ¥­æ¯”è¼ƒ')
                elif average_current_ratio > 1.5 and average_current_ratio < 2 :
                    st.write(f'è¿‘å››å­£å¹³å‡æµå‹•æ¯”ç‚ºï¼š{average_current_ratio}ï¼ŒåŠæ ¼ï¼Œå¯ä»¥èˆ‡åŒæ¥­æ¯”è¼ƒ') 
                else:
                    st.write(f'è¿‘å››å­£å¹³å‡æµå‹•æ¯”ç‚ºï¼š{average_current_ratio}ï¼Œå¾ˆä¸éŒ¯ï¼Œå¯ä»¥èˆ‡åŒæ¥­æ¯”è¼ƒ')
                    

                if average_quick_ratio < 1:
                    st.write(f'è¿‘å››å­£å¹³å‡é€Ÿå‹•æ¯”ç‚ºï¼š{average_quick_ratio}ï¼Œä½æ–¼1ï¼Œè«‹èˆ‡åŒæ¥­æ¯”è¼ƒ')
                elif average_quick_ratio > 1 and average_quick_ratio < 1.4 :
                    st.write(f'è¿‘å››å­£å¹³å‡é€Ÿå‹•æ¯”ç‚ºï¼š{average_quick_ratio}ï¼ŒåŠæ ¼ï¼Œå¯ä»¥èˆ‡åŒæ¥­æ¯”è¼ƒ') 
                else:
                    st.write(f'è¿‘å››å­£å¹³å‡é€Ÿå‹•æ¯”ç‚ºï¼š{average_quick_ratio}ï¼Œå¾ˆä¸éŒ¯ï¼Œå¯ä»¥èˆ‡åŒæ¥­æ¯”è¼ƒ')
                st.plotly_chart(fig2)
        except:
            pass
            
            
            
        ##########################
        st.write("")
        st.write("")
        st.write("")
        # HTMLå’ŒCSSç½®ä¸­æ¨£å¼
        st.markdown("""
            <div style="text-align: center; margin-top: 50px;">
                <p>ä»¥ä¸Šè§€é»åƒ…ä¾›åƒè€ƒï¼Œä¸¦ä¸æ§‹æˆä»»ä½•äº¤æ˜“å»ºè­°æˆ–æ¨è–¦</p>
            </div>
        """, unsafe_allow_html=True)
        
        
        
        
        
        
        
if __name__ == '__main__':
    main()
 